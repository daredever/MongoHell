## Welcome part

*Дима:*

Добрый день, друзья, рады приветствовать Вас на 58 встрече Петербургского .net сообщества, проходящей в коллаборации с Центром Речевых Технологий. 
Меня зовут Елисеев Дмитрий, я занимаюсь базами данных в ЦРТ. 

*Рома:*

Меня зовут Роман Щербаков, и я занимаюсь разработкой бэк-енда в ЦРТ и мы хотели бы рассказать Вам о внедрении MongoDB в .net проект. 
Обычно принято заранее показывать агенду, но мы намеренно не будем показывать вам оглавление нашего доклада, а почему, Вы поймёте чуть позже.

*Дима:*

Рассказ об обследовании проекта. 
И именно в этот момент начинается "Божественная комедия" внедрения MongoDB в .net проект.

#  Circles of Hell

## 1 круг - Лимб. 

*Дима:*

Предложение внедрить монгу. Как продать архитекторам и начальству 
Аргументы и примеры. Бенчмарки.
Бесплатно. 
Отказоустойчивость (кластер).
Спросить архитекторов, почему они согласились.

## 2 круг - Сладострастие.

*Дима:* 

Как побороть желание воткнуть технологию повсеместно, и использовать её только по назначению.
Решение внедрять технологию постепенно. 
Выбрать что-то одно, обкатать, пособирать шишки и грабли.
Выбор пал на импорт из внешних систем.


## 3 круг - Чревоугодие.

*Рома:*

Простота использования (Пример репозитория CRUD).
Отсутствие схемы (автоматическое создание базы и коллекций).
BSON документ (произвольные иерархические структуры данных) и простота стерилизации.
Хранение конфигурации для импорта. 
Хранение произвольных объектов в одной коллекции.
Перфоманс из коробки.
(Тут картинки с временем выполнения запросов)


## 4 круг - Жадность.

*Дима:*

Нагрузка данными. 
Быстрая деградация. 
Необходимость индексов.
Поняли что не все так просто.
(Тут картинки про рост времени выполнения запросов, таблички с количеством чтений индексов)


## 5 круг - Гнев и лень.

*Дима:*

Централизация использования технологий
Проблемы настройки кластера.
Анализ индексов.
Высокая трудоемкость при проектировании.


## 6 круг - Для еретиков и лжеучителей.

*Рома:*

Проблемы реляционного мышления при работе с noSQL(человеческий фактор).
Я сам .net разработчик с бэкграундом MS SQL SERVER и что я не понимал.

## 7 круг - Для насильников и убийц всех мастей (это относится к разработчикам монги).

*Рома:*

А теперь про боль и страдания:
Технические проблемы и трудности при переходе на MongoDB.
Connection string в виде URL.
Ограничение на размер документа.
Переписываем реализацию старых репозиториев.
Выделение отдельной сущности для singleton MongoClient.
Непривычная фильтрация.
Сериализация JObject отсутствует из коробки.
Транзакции только на кластере (минимальный кластер для разработки).
Нет атрибутов для индексов, кроме BsonId.
Особенности работы с индексами при построении запросов.


## 8 круг - Для обманувших не доверившихся.

*Дима:*

ci/cd и особенности настройки.
MongoShell.
Генераторы данных.
Генераторы индексов.


## 9 круг - Для обманувших доверившихся.

*Рома:*

Проблемы выявленные при тестировании.
- Проблемы с поиском по датам (фильтры).
- Проблемы с UI для администрирования данных.
- Проблемы сериализации (DateTimeOffset и GUID). 
- проблема версий пакета Mongo.Bson и необходимость Unit тестов на стерилизацию/десериализацию.

## Дорога к раю.

*Дима:*

Или почему MongoDB осталась основным хранилищем данных в проекте.




















